<script type="text/javascript">
function AddFolder() {
        var foldername=document.getElementById("foldername").value;
        var parentidhidd=document.getElementById("parentidhidd").value;
		var status=document.getElementById("txtStatus").value;
        if(foldername==""){
            alert("Please Fill Folder Name To Create");
            return false;
        }
        if (window.XMLHttpRequest) {
            xmlhttp = new XMLHttpRequest();
        } else {// code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
					
        xmlhttp.onreadystatechange=function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                var message = xmlhttp.responseText;
                // (message.indexOf("true") >= 0)
                if(message.indexOf("true") >= 0){
                    alert("Folder Already Exist");	
                    return false;
                }else{
                    $('#runtimeadd').append(message);
					var  i = document.getElementById("ivalue").value;
					i=parseFloat(i);
					document.getElementById("ivalue").value=(i+1);
					//$('#foldername').value = "";
                }
                //$("#videosDv").append(addStr);
            }
        }
                                      
        url = "<?php echo $strHostName; ?>/includes/addfolder.inc.php?foldername="+foldername+"&parentidhidd="+parentidhidd;
        xmlhttp.open("GET", url, true);
        xmlhttp.send();
		alert ("Folder created successfully.");
		redirectURL("<?php echo $strHostName; ?>/page.php?dir=inbox/view_mails&status="+status+"");
				
    }
	
	
	
function GetForm() {
        var MailCount=document.getElementById("txtMailCount").value;
		var mailsid=0;
		for (i=1;i < MailCount; i++ )
		{
			if (document.getElementById("chkTick"+i).checked==true)
			{
				mailsid=mailsid+","+document.getElementById("txtmailid"+i).value;
				alert (mailsid);
			}
		}
	
	    if (window.XMLHttpRequest)
        {// code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        }
        else
        {// code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange=function()
        {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200)
            {
                document.getElementById("saveform").innerHTML = xmlhttp.responseText;
            }
        }
		
        xmlhttp.open("GET","<?php echo $strHostName; ?>/includes/addfolderevent.inc.php?mailsid="+mailsid,true);
        xmlhttp.send();
    }
	
function UnselecMain(source)
{
	if (source.checked==false)
	{
		 document.getElementById("chkAll").checked=false;
	}
	 
}	 


function selectAll(source)
{
	//alert("dff");
	var checkboxes =document.getElementsByName("chkTick");
	for(var i=0, n=checkboxes.length;i<n;i++) 
	{
		checkboxes[i].checked = source.checked;
  	}
	 
}	 

		
</script>
<script type="text/javascript" language="javascript">
function DeleteMail()
{
	
	var MailCount=document.getElementById("txtMailCount").value;
	var mailsid=0;
	for (i=1;i < MailCount; i++ )
	{
		if (document.getElementById("chkTick"+i).checked==true)
		{
			mailsid=mailsid+","+document.getElementById("txtmailid"+i).value;
			//alert (mailsid);
		}
	}

	if (window.XMLHttpRequest)
	{// code for IE7+, Firefox, Chrome, Opera, Safari
		xmlhttp = new XMLHttpRequest();
	}
	else
	{// code for IE6, IE5
		xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
	}
	xmlhttp.onreadystatechange=function()
	{

		if (xmlhttp.readyState == 4 && xmlhttp.status == 200)
		{
			message = xmlhttp.responseText;
		}
	}

	//xmlhttp.open("GET","<?php echo $strHostName; ?>/includes/search_profile.inc.php?mailsid="+mailsid, true);
	//xmlhttp.send();
	
}
	
function MoveTo(foldername, folderid)
{
	
	//alert (type);
	//DeleteMail();

	if (foldername=="Delete")
	{
		if (confirm("Are you sure you want to delete?")==false)
		{
			return false;
		}
		
	}
	
	var MailCount=document.getElementById("txtMailCount").value;
	var mail_type="";
	//var status=document.getElementById("txtStatus").value;
	//var mail_type=document.getElementById("txtMailType").value;
	
	//alert(status);
	//alert(document.getElementById("txtMailType").value);
	
	var mailsid="0";
	for (i=1;i < MailCount; i++ )
	{
		if (document.getElementById("chkTick"+i).checked==true)
		{
			mail_type=document.getElementById("txtMailType"+i).value;
			mailsid=mailsid+","+document.getElementById("txtmailid"+i).value+"@@@"+mail_type;
			
		}
	}
	
	if (window.XMLHttpRequest)
	{
		// code for IE7+, Firefox, Chrome, Opera, Safari
		xmlhttp = new XMLHttpRequest();
	}
	else
	{// code for IE6, IE5
		xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
	}
	xmlhttp.onreadystatechange=function()
	{

		if (xmlhttp.readyState == 4 && xmlhttp.status == 200)
		{
			message = xmlhttp.responseText;
			if (foldername=="Delete")
			{
				alert("Records deleted succesfully");
			}
			else
			{
				alert("Records moved succesfully to "+ foldername );
			}
			redirectURL(window.location.href);
			
		}
	}
	//document.write("<?php echo $strHostName; ?>/includes/move_mails.inc.php?type=User&mailsid="+mailsid+"&folderid="+folderid+"&foldername="+foldername, true);y
	xmlhttp.open("GET","<?php echo $strHostName; ?>/includes/move_mails.inc.php?type=User&mailsid="+mailsid+"&folderid="+folderid+"&foldername="+foldername, true);
	xmlhttp.send();
	
	
}

function Mail_Delete_By_Id()
{
	var status=document.getElementById("txtStatus").value;
	if (confirm("Are you sure you want to delete this record ?"))
	{
		var MailCount=document.getElementById("txtMailCount").value;
		var mailsid=0;
		for (i=1;i < MailCount; i++ )
		{
			if (document.getElementById("chkTick"+i).checked==true)
			{
				mailsid=mailsid+","+document.getElementById("txtmailid"+i).value;
				alert (mailsid);
			}
			
		}
	
		var message="";
		var day="";
		if (window.XMLHttpRequest)
		{// for IE7+, Firefox, Chrome, Opera, Safaricodes
			xmlhttp = new XMLHttpRequest();
		}
		else
		{// code for IE6, IE5
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.onreadystatechange=function()
		{
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200)
			{	
				 message = xmlhttp.responseText;
				// alert(message);
				 document.getElementById("tr_mail_"+i).style.display='none';
			}
		}
		xmlhttp.open("GET",hostname+"/includes/delete_reocrds.inc.php?insert_type=Compose_Ins&cid="+mailsid,true);
		xmlhttp.send();
		redirectURL("<?php echo $strHostName; ?>/page.php?dir=inbox/view_mails&status="+status+"");
	}
	
}

function Mails_Retrive_By_Id(id)
{
	//document.getElementById("txtComDate").innerHTML=id;
	document.getElementById("txt_Inbox_Message").innerHTML=id;
	
		var message="";
	var day="";
	if (window.XMLHttpRequest)
	{// for IE7+, Firefox, Chrome, Opera, Safaricodes
		xmlhttp = new XMLHttpRequest();
	}
	else
	{// code for IE6, IE5
		xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
	}
	xmlhttp.onreadystatechange=function()
	{
		if (xmlhttp.readyState == 4 && xmlhttp.status == 200)
		{	
			 message = JSON.parse(xmlhttp.responseText);
			 data = {"records":message};
			// alert (message);
			// alert (data.records.length);
			
			 for (var i = 0; i < data.records.length; ++i) {
					document.getElementById("cmb_Day" ).innerHTML=data.records[i].last_occurrency_day;
					document.getElementById("cmb_Month" ).innerHTML=data.records[i].last_occurrency_month;
					document.getElementById("cmb_Year" ).innerHTML=data.records[i].last_occurrency_year;
					document.getElementById("Consulted_of_problem" ).innerHTML=data.records[i].doctor_consulted;
					document.getElementById("cmb_Inbox_Query_Type" ).innerHTML=data.records[i].query_type;	
					document.getElementById("cmb_Inbox_Body_Area" ).innerHTML=data.records[i].body_area;
					document.getElementById("txt_Inbox_suffer_Medical_Problem" ).innerHTML=data.records[i].suffer_from;
					document.getElementById("ddl_Doc_Consulted" ).innerHTML=data.records[i].doctor_id;	
					document.getElementById("cmb_Inbox_Doctor_Comment" ).innerHTML=data.records[i].doc_comment;	
					document.getElementById("Inbox_Video_Query" ).innerHTML=data.records[i].video_query_requirement;
					document.getElementById("txtMailID" ).innerHTML=data.records[i].mail_id;
			 }
		}
	}
	xmlhttp.open("GET",hostname+"/retrive_files/retrive_reocrds.inc.php?insert_type=Compose_Ins&cid="+id,true);
	xmlhttp.send();
}					
</script>




<?php
	$page=1;$page_count=10;$newpagenumber="2";$retrive_Array=array();$get_array=array();
	if(isset($_GET['page'])){
		$page=$_GET['page'];
	}
	else
	{
		$page=1;
	}
	
	if(isset($_GET['status'])){
		$status=$_GET['status'];
	}
	else
	{
		$status="";
	}

	if(isset($_GET['folderid']))
	{
		$folderid =$converter->decode($_GET['folderid']);
	}
	else
	{
		$folderid="0";
	}

	
	//Alert($folderid);

	if(isset($_SESSION['UserID']))
	{
		$UserID=$_SESSION['UserID'];
	}

	
	$retrive_Array=$get_retrive->GetMails($page_count,0,$folderid,$UserID);
	

	
	$nume=$get_retrive->GetMails_Count($folderid,$UserID);

	if($nume !="0")
	{
		$newpagenumber=($nume/$page_count);
		if($newpagenumber==""){$newpagenumber="0";}else{$newpagenumber=$newpagenumber+1;}
		$newpagenumber=round($newpagenumber);
		if($page > $newpagenumber)
		{
			$newpagenumber=1;
		}
		else
		{
			$newpagenumber="";
		}
	}
	$pagingLink = getPagingLinkBackEndFrontEnd($nume,$page_count,'dir=inbox/view_mails',$newpagenumber,$strHostName."/page.php");
	
	
?>

 <div class="Inbox_td_right">
               
              <table width="750px" border="0" cellpadding="0" cellspacing="0">
				<?php if($nume > 0 ){ ?>
                  <tr>
					<td class="Inboxbg1" style="padding-top:10px;vertical-align:top; width:50px;">
                    <input type="checkbox" id="chkAll" name="chkAll" value="" onclick="javascript:selectAll(this);"/></td>
               
                    <td class="Inboxbg2" colspan="2"><table width="150px;" border="0" cellpadding="0" cellspacing="0">
                        <tr>
                    
                          <td style="padding:0px 5px;vertical-align:top">
                          	 
                                   <div style="float:left; background-color:#666666; color:#FFFFFF; padding:5px 15px"> <a onclick="javascript:MoveTo('Delete', '<?php echo $converter->encode("999999");?>');" style="text-align:center; font-size:14px;text-transform:none;font-family: 'myriad_web_proregular'; color:#FFFFFF; cursor:pointer;">Delete</a></div>
                            
                            
                          </td>
                          <td style="padding:0px 5px; vertical-align:top">
                          		
                                	<div style="float:left; width:90px; border:solid 0px red;">
                                        <div style="float:left; width:90px; border:solid 0px red;">
                                        <ul id="dd_nav1">
                                          <li> <a href="#" style="background-color:#666666; font-weight:normal; padding:5px 10px; width:70px"> Move to&nbsp;<span class="ar">&#9660;</span> </a>
                                            <ul style="width: 90px; background-color: #666;line-height:25px">
                                              <li style="border-bottom: solid 0px #aac457;"><a style="cursor:pointer;"  onclick="javascript:MoveTo('Trash', '<?php echo $converter->encode($get_retrive->RetriveUserTrashID($_SESSION['UserID']));?>');">Trash</a></li>
                                           
                                               <?php $FolderArray=$get_retrive->GetFolders($_SESSION['UserID']) ;  ?>	  
                                  <?php  while($folder = mysql_fetch_array( $FolderArray )){?>
                                    <li style="border-bottom: solid 0px #aac457;"><a style="cursor:pointer;"  onclick="javascript:MoveTo('<?php echo $folder['name']?>', '<?php echo $converter->encode($folder['id']);?>');"><?php echo $folder['name']?></a></li>
                                    
                                  <?php }?>
                                            </ul>
                                          </li>
                                        </ul>
                                      </div>
                             		</div>
                               
                            </td>
                     
                          <td style="padding:0px 5px; vertical-align:top">
                            <div style="float:left; background-color:#666666; padding:4px 10px 2px 10px;width:90px;"> 
                          		 <input type="submit" name="savnbtn" id="savnbtn5" value="Create Folder" onClick="javascript:Popup.showModal('dvAdd1',null,null,{'screenColor':'#000','screenOpacity':.5});
									GetForm()" style="text-align:center; font-size:14px;text-transform:none;font-family: 'myriad_web_proregular'; color:#FFFFFF; background-color: #666; border:0px; padding:0px; cursor:pointer;"/>
                                
                            </div>
                           </td>
                        </tr>
                      </table></td>
                    <td class="Inboxbg4" style="vertical-align:top; text-align:right">
                    	  <?php if($_SESSION['UserType']!="Nutritionist") { ?>
                            <div style="float:right; width:87px; border:solid 0px red; text-align:right">
                            <ul id="dd_nav2">
                              <li> <a href="#" style="background-color:#c02c3e; font-weight:normal;"><img src="images/compose_mail_icon.jpg" alt="" style="float:left" />&nbsp;Compose&nbsp;<span class="ar">&#9660;</span> </a>
                                <ul style="width: 97px;line-height:15px">
                                  <li style="background-color: #99cc00; text-align:center"><a target="_parent" href="<?php echo $strHostName;?>/page.php?dir=inbox/compose_doctor" style="color:#FFFFFF;cursor: pointer;">Doctor </a></li>
                                  <li style="background-color: #009999; text-align:center; display:'';"><a href="<?php echo $strHostName;?>/page.php?dir=inbox/compose_nutritionist" style="color:#FFF;cursor: pointer;">Nutritionist</a></li>
                                </ul>
                              </li>
                            </ul>
                          </div>
               			<?php } ?>
                  </td>
                  
                  </tr>
                    <?php } ?>
                  <tr>
                    <td class="f_white" colspan="6" style="height: 5px;padding:15px 0px 0px 0px"></td>
                  </tr>
                
                   <?php $i=0;
						$i=$i+1;
						while($get_array = mysql_fetch_array( $retrive_Array )){?>
	  				<tr id="tr_mail_<?php echo $i;?>" style="display:'';">
                        <td class="lightInboxbg1">
                        
                         <input type="checkbox" name="chkTick" id="chkTick<?php echo $i?>" style="float:left; text-align:left; width:25px; margin-top:8px;" onchange="javascript:UnselecMain(this);">
                         
                         
                       <input type="text" id="txtMailType<?php echo $i?>" name="txtMailType<?php echo $i?>" value="<?php echo $get_array['mail_type'];?>" style="width:50px;"/>

                        <input type="hidden" id="txtmailid<?php echo $i?>" name="txtmailid<?php echo $i?>" value="<?php echo $get_array['mail_id']?>" style="width:20px;"/>
                        </td>
						<td class="lightInboxbg21" style="width:100px;">
							<a href="<?php echo $strHostName;?>/page_doctor.php?dir=inbox/detailed_mail&mail_id=<?php echo  $converter->encode($get_array['mail_id']);?>"><?php echo $get_array['complaint'];?></a>
					   </td>
                         <td class="lightInboxbg3"> 
							<?php  
								 
								echo $doctor_name=GetValue("select doctor_name as col from tbl_doctor where doctor_id=".$get_array['doctor_id'], "col");
								 
							?> 
						</td>
                        
                        
                        <td class="lightInboxbg4"><?php echo date('d-M-Y h:i:s',strtotime($get_array['created_date']))?> </td>
                       
                      </tr>
                      <tr>
                        <td class="f_white" colspan="6" style="height: 5px;"></td>
                      </tr>
                   <?php $i=$i+1; } ?>
                    <input type="hidden" name="txtStatus" id="txtStatus" value="<?php echo $_GET['status']?>"  />
                   <input type="hidden" id="txtMailCount" name="txtMailCount" value="<?php echo $i?>"/>
                 </table>
              </div>

            
 <div class="DvFloat">
                <div style="text-align: center; padding: 10px 0px; width: 967px; float: left; border: solid 0px #000000;">
                  <div class="pagination_md">
                  <?php echo $pagingLink ?>
                    <div style="width: 22px; float: left; border: solid 0px #0066FF; padding: 0px; margin:-5px 0px 0px 0px; display:none;"><a href="#"><img src="images/prev_md_paging.png" alt="" title="" border="0" /></a></div>
                    <div style="width: 740px; float: left; border: solid 0px #006600; display:none;"><span class="selected">1</span> <a href="#">2</a> <a href="#">3</a> <a href="#">4</a> <a href="#">5</a> <a href="#">6</a> <a href="#">7</a> </div>
                    <div style="width: 22px;  float: left; border: solid 0px #0066FF; padding: 0px; margin:-5px 0px 0px 0px; display:none;"><a href="#"><img src="images/next_md_paging.png" alt="" title="" border="0" /></a></div>
                  </div>
                </div>
              </div>
<center>
    <div id="dvAdd1" style="width: 100%; position: absolute;display: none;top: 0px;">
      <div id="saveform" style="width: 100%;top: 0px; position: absolute;"></div>
    </div>
</center>


<div id="dvpopup-form1" style="text-align: center; width: 100%;position:absoulte;margin:0px; margin-top:15px; display:none">
  <table cellpadding="0" cellspacing="0" border="0" width="100%" align="center">
    <tr>
      <td style="text-align:right; border:solid 0px red; float:right"><div style="margin: 5px 0px 0px -23px; position: absolute; text-align:right"> <a href="javascript:Popup.hide('dvpopup-form1');" target="_parent" style="text-decoration: none; color: #fff;"> <img src="images/close.png" alt="" title="" border="0" /> </a> </div></td>
    </tr>
    <tr>
      <td valign="top" align="center" style="padding: 10px 10px 10px 10px;background-color:#FFFFFF">
      		<?php include "view_files/compose.inc.php";?>
      </td>
    </tr>
  </table>
</div>